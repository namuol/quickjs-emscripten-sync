{"version":3,"file":"quickjs-emscripten-sync.modern.js","sources":["../src/vmmap.ts","../src/util.ts","../src/vmutil.ts","../src/marshal/properties.ts","../src/marshal/function.ts","../src/marshal/object.ts","../src/marshal/primitive.ts","../src/marshal/symbol.ts","../src/marshal/index.ts","../src/unmarshal/properties.ts","../src/unmarshal/function.ts","../src/unmarshal/object.ts","../src/unmarshal/primitive.ts","../src/unmarshal/symbol.ts","../src/unmarshal/index.ts","../src/wrapper.ts","../src/default.ts","../src/index.ts"],"sourcesContent":["import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\n\nexport default class VMMap {\n  vm: QuickJSVm;\n  _map1: Map<any, number> = new Map();\n  _map2: Map<any, number> = new Map();\n  _map3: Map<number, QuickJSHandle> = new Map();\n  _map4: Map<number, QuickJSHandle> = new Map();\n  _counterMap: Map<number, any> = new Map();\n  _disposables: Set<QuickJSHandle> = new Set();\n  _mapGet: QuickJSHandle;\n  _mapSet: QuickJSHandle;\n  _mapDelete: QuickJSHandle;\n  _mapClear: QuickJSHandle;\n  _counter = 0;\n\n  constructor(vm: QuickJSVm) {\n    this.vm = vm;\n\n    const result = vm\n      .unwrapResult(\n        vm.evalCode(`() => {\n        const mapSym = new Map();\n        let map = new WeakMap();\n        let map2 = new WeakMap();\n        const isObj = o => typeof o === \"object\" && o !== null || typeof o === \"function\";\n        return {\n          get: key => mapSym.get(key) ?? map.get(key) ?? map2.get(key) ?? -1,\n          set: (key, value, key2) => {\n            if (typeof key === \"symbol\") mapSym.set(key, value);\n            if (isObj(key)) map.set(key, value);\n            if (isObj(key2)) map2.set(key2, value);\n          },\n          delete: (key, key2) => {\n            mapSym.delete(key);\n            map.delete(key);\n            map2.delete(key2);\n          },\n          clear: () => {\n            mapSym.clear();\n            map = new WeakMap();\n            map2 = new WeakMap();\n          }\n        };\n      }`)\n      )\n      .consume((fn) => this._call(fn, undefined));\n\n    this._mapGet = vm.getProp(result, \"get\");\n    this._mapSet = vm.getProp(result, \"set\");\n    this._mapDelete = vm.getProp(result, \"delete\");\n    this._mapClear = vm.getProp(result, \"clear\");\n\n    result.dispose();\n\n    this._disposables.add(this._mapGet);\n    this._disposables.add(this._mapSet);\n    this._disposables.add(this._mapDelete);\n    this._disposables.add(this._mapClear);\n  }\n\n  set(\n    key: any,\n    handle: QuickJSHandle,\n    key2?: any,\n    handle2?: QuickJSHandle\n  ): boolean {\n    if (!handle.alive || (handle2 && !handle2.alive)) return false;\n\n    const v = this.get(key) ?? this.get(key2);\n    if (v) {\n      // handle and handle2 are unused so they should be disposed\n      return v === handle || v === handle2;\n    }\n\n    const counter = this._counter++;\n    this._map1.set(key, counter);\n    this._map3.set(counter, handle);\n    this._counterMap.set(counter, key);\n    if (key2) {\n      this._map2.set(key2, counter);\n      if (handle2) {\n        this._map4.set(counter, handle2);\n      }\n    }\n\n    this.vm.newNumber(counter).consume((c) => {\n      this._call(\n        this._mapSet,\n        undefined,\n        handle,\n        c,\n        handle2 ?? this.vm.undefined\n      );\n    });\n\n    return true;\n  }\n\n  merge(\n    iteratable:\n      | Iterable<\n          | [any, QuickJSHandle | undefined]\n          | [any, QuickJSHandle | undefined, any, QuickJSHandle | undefined]\n        >\n      | undefined\n  ) {\n    if (!iteratable) return;\n    for (const iter of iteratable) {\n      if (!iter) continue;\n      if (iter[1]) {\n        this.set(iter[0], iter[1], iter[2], iter[3]);\n      }\n    }\n  }\n\n  get(key: any) {\n    const num = this._map1.get(key) ?? this._map2.get(key);\n    const handle = typeof num === \"number\" ? this._map3.get(num) : undefined;\n\n    if (!handle) return;\n    if (!handle.alive) {\n      this.delete(key);\n      return;\n    }\n\n    return handle;\n  }\n\n  getByHandle(handle: QuickJSHandle) {\n    if (!handle.alive) {\n      return;\n    }\n    return this._counterMap.get(\n      this.vm.getNumber(this._call(this._mapGet, undefined, handle))\n    );\n  }\n\n  has(key: any) {\n    return !!this.get(key);\n  }\n\n  hasHandle(handle: QuickJSHandle) {\n    return typeof this.getByHandle(handle) !== \"undefined\";\n  }\n\n  delete(key: any, dispose?: boolean) {\n    const num = this._map1.get(key) ?? this._map2.get(key);\n    if (typeof num === \"undefined\") return;\n\n    const handle = this._map3.get(num);\n    const handle2 = this._map4.get(num);\n    this._call(\n      this._mapDelete,\n      undefined,\n      ...[handle, handle2].filter((h): h is QuickJSHandle => !!h?.alive)\n    );\n\n    this._map1.delete(key);\n    this._map2.delete(key);\n    this._map3.delete(num);\n    this._map4.delete(num);\n\n    for (const [k, v] of this._map1) {\n      if (v === num) {\n        this._map1.delete(k);\n        break;\n      }\n    }\n\n    for (const [k, v] of this._map2) {\n      if (v === num) {\n        this._map2.delete(k);\n        break;\n      }\n    }\n\n    for (const [k, v] of this._counterMap) {\n      if (v === key) {\n        this._counterMap.delete(k);\n        break;\n      }\n    }\n\n    if (dispose) {\n      if (handle?.alive) handle.dispose();\n      if (handle2?.alive) handle2.dispose();\n    }\n  }\n\n  deleteByHandle(handle: QuickJSHandle, dispose?: boolean) {\n    const key = this.getByHandle(handle);\n    if (typeof key !== \"undefined\") {\n      this.delete(key, dispose);\n    }\n  }\n\n  clear() {\n    this._counter = 0;\n    this._map1.clear();\n    this._map2.clear();\n    this._map3.clear();\n    this._map4.clear();\n    this._counterMap.clear();\n    if (this._mapClear.alive) {\n      this._call(this._mapClear, undefined);\n    }\n  }\n\n  dispose() {\n    for (const v of this._disposables.values()) {\n      if (v.alive) {\n        v.dispose();\n      }\n    }\n    for (const v of this._map3.values()) {\n      if (v.alive) {\n        v.dispose();\n      }\n    }\n    for (const v of this._map4.values()) {\n      if (v.alive) {\n        v.dispose();\n      }\n    }\n    this._disposables.clear();\n    this.clear();\n  }\n\n  get size() {\n    return this._map1.size;\n  }\n\n  [Symbol.iterator](): Iterator<\n    [any, QuickJSHandle, any, QuickJSHandle | undefined]\n  > {\n    const keys = this._map1.keys();\n    return {\n      next: () => {\n        while (true) {\n          const k1 = keys.next();\n          if (k1.done) return { value: undefined, done: true };\n          const n = this._map1.get(k1.value);\n          if (typeof n === \"undefined\") continue;\n          const v1 = this._map3.get(n);\n          const v2 = this._map4.get(n);\n          if (!v1) continue;\n          const k2 = this._get2(n);\n          return { value: [k1.value, v1, k2, v2], done: false };\n        }\n      },\n    };\n  }\n\n  _get2(num: number) {\n    for (const [k, v] of this._map2) {\n      if (v === num) return k;\n    }\n  }\n\n  _call(\n    fn: QuickJSHandle,\n    thisArg: QuickJSHandle | undefined,\n    ...args: QuickJSHandle[]\n  ) {\n    return this.vm.unwrapResult(\n      this.vm.callFunction(\n        fn,\n        typeof thisArg === \"undefined\" ? this.vm.undefined : thisArg,\n        ...args\n      )\n    );\n  }\n}\n","export function isES2015Class(cls: any): cls is new (...args: any[]) => any {\n  return (\n    typeof cls === \"function\" &&\n    /^class\\s/.test(Function.prototype.toString.call(cls))\n  );\n}\n\nexport function isObject(value: any): value is object | Function {\n  return (\n    typeof value === \"function\" || (typeof value === \"object\" && value !== null)\n  );\n}\n\nexport function walkObject(\n  value: any,\n  callback?: (target: any, set: Set<any>) => boolean | void\n): Set<any> {\n  const set = new Set<any>();\n  const walk = (v: any) => {\n    if (!isObject(v) || set.has(v) || callback?.(v, set) === false) return;\n    set.add(v);\n\n    if (Array.isArray(v)) {\n      for (const e of v) {\n        walk(e);\n      }\n      return;\n    }\n\n    if (typeof v === \"object\") {\n      const proto = Object.getPrototypeOf(v);\n      if (proto && proto !== Object.prototype) {\n        walk(proto);\n      }\n    }\n\n    for (const d of Object.values(Object.getOwnPropertyDescriptors(v))) {\n      if (\"value\" in d) walk(d.value);\n      if (\"get\" in d) walk(d.get);\n      if (\"set\" in d) walk(d.set);\n    }\n  };\n\n  walk(value);\n  return set;\n}\n\n/**\n * Measure the complexity of an object as you traverse the field and prototype chain. If max is specified, when the complexity reaches max, the traversal is terminated and it returns the max. In this function, one object and function are counted as a complexity of 1, and primitives are not counted as a complexity.\n */\nexport function complexity(value: any, max?: number): number {\n  return walkObject(value, max ? (_, set) => set.size < max : undefined).size;\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\n\nexport function call(\n  vm: QuickJSVm,\n  code: string,\n  thisArg?: QuickJSHandle,\n  ...args: QuickJSHandle[]\n): QuickJSHandle {\n  return vm.unwrapResult(vm.evalCode(code)).consume((f) => {\n    if (typeof thisArg === \"undefined\" && args.length === 0) return f;\n    return vm.unwrapResult(\n      vm.callFunction(f, thisArg ?? vm.undefined, ...args)\n    );\n  });\n}\n\nexport function eq(vm: QuickJSVm, a: QuickJSHandle, b: QuickJSHandle): boolean {\n  return vm.dump(call(vm, \"Object.is\", undefined, a, b));\n}\n\nexport function instanceOf(\n  vm: QuickJSVm,\n  a: QuickJSHandle,\n  b: QuickJSHandle\n): boolean {\n  return vm.dump(call(vm, \"(a, b) => a instanceof b\", undefined, a, b));\n}\n\nexport function isHandleObject(vm: QuickJSVm, a: QuickJSHandle): boolean {\n  return vm.dump(\n    call(\n      vm,\n      `a => typeof a === \"object\" && a !== null || typeof a === \"function\"`,\n      undefined,\n      a\n    )\n  );\n}\n\nexport function send(vm: QuickJSVm, target: any): QuickJSHandle {\n  const json = JSON.stringify(target);\n  if (!json) return vm.undefined;\n  return call(vm, `JSON.parse`, undefined, vm.newString(json));\n}\n\nexport function consumeAll<T extends QuickJSHandle[], K>(\n  handles: T,\n  cb: (handles: T) => K\n): K {\n  try {\n    return cb(handles);\n  } finally {\n    for (const h of handles) {\n      if (h.alive) h.dispose();\n    }\n  }\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport { call } from \"../vmutil\";\n\nexport default function marshalProperties(\n  vm: QuickJSVm,\n  target: object | Function,\n  handle: QuickJSHandle,\n  marshal: (target: unknown) => QuickJSHandle\n): void {\n  const descs = vm.newObject();\n  const cb = (key: string | number | symbol, desc: PropertyDescriptor) => {\n    const keyHandle = marshal(key);\n    const valueHandle =\n      typeof desc.value === \"undefined\" ? undefined : marshal(desc.value);\n    const getHandle =\n      typeof desc.get === \"undefined\" ? undefined : marshal(desc.get);\n    const setHandle =\n      typeof desc.set === \"undefined\" ? undefined : marshal(desc.set);\n\n    vm.newObject().consume((descObj) => {\n      Object.entries(desc).forEach(([k, v]) => {\n        const v2 =\n          k === \"value\"\n            ? valueHandle\n            : k === \"get\"\n            ? getHandle\n            : k === \"set\"\n            ? setHandle\n            : v\n            ? vm.true\n            : vm.false;\n        if (v2) {\n          vm.setProp(descObj, k, v2);\n        }\n      });\n      vm.setProp(descs, keyHandle, descObj);\n    });\n  };\n\n  const desc = Object.getOwnPropertyDescriptors(target);\n  Object.entries(desc).forEach(([k, v]) => cb(k, v));\n  Object.getOwnPropertySymbols(desc).forEach((k) => cb(k, (desc as any)[k]));\n\n  call(vm, `Object.defineProperties`, undefined, handle, descs).dispose();\n\n  descs.dispose();\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport { isES2015Class, isObject } from \"../util\";\nimport { call } from \"../vmutil\";\nimport marshalProperties from \"./properties\";\n\nexport default function marshalFunction(\n  vm: QuickJSVm,\n  target: unknown,\n  marshal: (target: unknown) => QuickJSHandle,\n  unmarshal: (handle: QuickJSHandle) => unknown,\n  preMarshal: (\n    target: unknown,\n    handle: QuickJSHandle\n  ) => QuickJSHandle | undefined,\n  preApply?: (target: Function, thisArg: unknown, args: unknown[]) => any\n): QuickJSHandle | undefined {\n  if (typeof target !== \"function\") return;\n\n  const raw = vm\n    .newFunction(target.name, function (...argHandles) {\n      const that = unmarshal(this);\n      const args = argHandles.map((a) => unmarshal(a));\n\n      if (isES2015Class(target) && isObject(that)) {\n        // Class constructors cannot be invoked without new expression, and new.target is not changed\n        const result = new target(...args);\n        Object.entries(result).forEach(([key, value]) => {\n          vm.setProp(this, key, marshal(value));\n        });\n        return this;\n      }\n\n      return marshal(\n        preApply ? preApply(target, that, args) : target.apply(that, args)\n      );\n    })\n    .consume((handle2) =>\n      // fucntions created by vm.newFunction are not callable as a class constrcutor\n      call(\n        vm,\n        `Cls => {\n          const fn = function(...args) { return Cls.apply(this, args); };\n          fn.name = Cls.name;\n          fn.length = Cls.length;\n          return fn;\n        }`,\n        undefined,\n        handle2\n      )\n    );\n\n  const handle = preMarshal(target, raw) ?? raw;\n  marshalProperties(vm, target, raw, marshal);\n\n  return handle;\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport { call } from \"../vmutil\";\nimport marshalProperties from \"./properties\";\n\nexport default function marshalObject(\n  vm: QuickJSVm,\n  target: unknown,\n  marshal: (target: unknown) => QuickJSHandle,\n  preMarshal: (\n    target: unknown,\n    handle: QuickJSHandle\n  ) => QuickJSHandle | undefined\n): QuickJSHandle | undefined {\n  if (typeof target !== \"object\" || target === null) return;\n\n  const raw = Array.isArray(target) ? vm.newArray() : vm.newObject();\n  const handle = preMarshal(target, raw) ?? raw;\n\n  // prototype\n  const prototype = Object.getPrototypeOf(target);\n  const prototypeHandle =\n    prototype && prototype !== Object.prototype && prototype !== Array.prototype\n      ? marshal(prototype)\n      : undefined;\n  if (prototypeHandle) {\n    call(\n      vm,\n      \"Object.setPrototypeOf\",\n      undefined,\n      handle,\n      prototypeHandle\n    ).dispose();\n  }\n\n  marshalProperties(vm, target, raw, marshal);\n\n  return handle;\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\n// import { call } from \"../vmutil\";\n\nexport default function marshalPrimitive(\n  vm: QuickJSVm,\n  target: unknown\n): QuickJSHandle | undefined {\n  switch (typeof target) {\n    case \"undefined\":\n      return vm.undefined;\n    case \"number\":\n      return vm.newNumber(target);\n    case \"string\":\n      return vm.newString(target);\n    case \"boolean\":\n      return target ? vm.true : vm.false;\n    case \"object\":\n      return target === null ? vm.null : undefined;\n\n    // BigInt is not supported by quickjs-emscripten\n    // case \"bigint\":\n    //   return call(\n    //     vm,\n    //     `s => BigInt(s)`,\n    //     undefined,\n    //     vm.newString(target.toString())\n    //   );\n  }\n\n  return undefined;\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport { call } from \"../vmutil\";\n\nexport default function marshalSymbol(\n  vm: QuickJSVm,\n  target: unknown,\n  preMarshal: (\n    target: unknown,\n    handle: QuickJSHandle\n  ) => QuickJSHandle | undefined\n): QuickJSHandle | undefined {\n  if (typeof target !== \"symbol\") return;\n  const handle = call(\n    vm,\n    \"d => Symbol(d)\",\n    undefined,\n    target.description ? vm.newString(target.description) : vm.undefined\n  );\n  return preMarshal(target, handle) ?? handle;\n}\n","import { QuickJSHandle, QuickJSVm } from \"quickjs-emscripten\";\nimport marshalFunction from \"./function\";\nimport marshalObject from \"./object\";\nimport marshalPrimitive from \"./primitive\";\nimport marshalSymbol from \"./symbol\";\n\nexport type Options = {\n  vm: QuickJSVm;\n  unmarshal: (handle: QuickJSHandle) => unknown;\n  isMarshalable?: (target: unknown) => boolean;\n  find: (target: unknown) => QuickJSHandle | undefined;\n  pre: (target: unknown, handle: QuickJSHandle) => QuickJSHandle | undefined;\n  preApply?: (target: Function, thisArg: unknown, args: unknown[]) => any;\n};\n\nexport function marshal(target: unknown, options: Options): QuickJSHandle {\n  const { vm, unmarshal, isMarshalable, find, pre } = options;\n\n  {\n    const primitive = marshalPrimitive(vm, target);\n    if (primitive) {\n      return primitive;\n    }\n  }\n\n  {\n    const handle = find(target);\n    if (handle) return handle;\n  }\n\n  if (isMarshalable?.(target) === false) {\n    return vm.undefined;\n  }\n\n  const marshal2 = (t: unknown) => marshal(t, options);\n\n  const result =\n    marshalSymbol(vm, target, pre) ??\n    marshalFunction(vm, target, marshal2, unmarshal, pre, options.preApply) ??\n    marshalObject(vm, target, marshal2, pre) ??\n    vm.undefined;\n\n  return result;\n}\n\nexport default marshal;\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport { call } from \"../vmutil\";\n\nexport default function unmarshalProperties(\n  vm: QuickJSVm,\n  handle: QuickJSHandle,\n  target: object | Function,\n  unmarshal: (handle: QuickJSHandle) => [unknown, boolean]\n) {\n  vm.newFunction(\"\", (key, value) => {\n    const [keyName] = unmarshal(key);\n    if (\n      typeof keyName !== \"string\" &&\n      typeof keyName !== \"number\" &&\n      typeof keyName !== \"symbol\"\n    )\n      return;\n\n    const desc = (\n      [\n        [\"value\", true],\n        [\"get\", true],\n        [\"set\", true],\n        [\"configurable\", false],\n        [\"enumerable\", false],\n        [\"writable\", false],\n      ] as const\n    ).reduce<PropertyDescriptor>((desc, [key, unmarshable]) => {\n      const h = vm.getProp(value, key);\n      const ty = vm.typeof(h);\n\n      if (ty === \"undefined\") return desc;\n      if (!unmarshable && ty === \"boolean\") {\n        desc[key] = vm.dump(vm.getProp(value, key));\n        return desc;\n      }\n\n      const [v, alreadyExists] = unmarshal(h);\n      if (alreadyExists) {\n        h.dispose();\n      }\n      desc[key] = v;\n\n      return desc;\n    }, {});\n\n    Object.defineProperty(target, keyName, desc);\n  }).consume((fn) => {\n    call(\n      vm,\n      `(o, fn) => {\n        const descs = Object.getOwnPropertyDescriptors(o);\n        Object.entries(descs).forEach(([k, v]) => fn(k, v));\n        Object.getOwnPropertySymbols(descs).forEach(k => fn(k, descs[k]));\n      }`,\n      undefined,\n      handle,\n      fn\n    ).dispose();\n  });\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport { call } from \"../vmutil\";\nimport unmarshalProperties from \"./properties\";\n\nexport default function unmarshalFunction(\n  vm: QuickJSVm,\n  handle: QuickJSHandle,\n  marshal: (value: unknown) => QuickJSHandle,\n  unmarshal: (handle: QuickJSHandle) => [unknown, boolean],\n  preUnmarshal: <T>(target: T, handle: QuickJSHandle) => T | undefined\n): Function | undefined {\n  if (vm.typeof(handle) !== \"function\") return;\n\n  const raw = function (this: any, ...args: any[]) {\n    const thisHandle = marshal(this);\n    const argHandles = args.map((a) => marshal(a));\n\n    if (new.target) {\n      const [instance] = unmarshal(\n        call(\n          vm,\n          `(Cls, ...args) => new Cls(...args)`,\n          thisHandle,\n          handle,\n          ...argHandles\n        )\n      );\n      Object.defineProperties(this, Object.getOwnPropertyDescriptors(instance));\n      return this;\n    }\n\n    const resultHandle = vm.unwrapResult(\n      vm.callFunction(handle, thisHandle, ...argHandles)\n    );\n    const [result, alreadyExists] = unmarshal(resultHandle);\n    if (alreadyExists) resultHandle.dispose();\n    return result;\n  };\n\n  const func = preUnmarshal(raw, handle) ?? raw;\n  unmarshalProperties(vm, handle, raw, unmarshal);\n\n  return func;\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport unmarshalProperties from \"./properties\";\nimport { call } from \"../vmutil\";\n\nexport default function unmarshalObject(\n  vm: QuickJSVm,\n  handle: QuickJSHandle,\n  unmarshal: (handle: QuickJSHandle) => [unknown, boolean],\n  preUnmarshal: <T>(target: T, handle: QuickJSHandle) => T | undefined\n): object | undefined {\n  if (\n    vm.typeof(handle) !== \"object\" ||\n    // null check\n    vm\n      .unwrapResult(vm.evalCode(\"o => o === null\"))\n      .consume((n) =>\n        vm.dump(vm.unwrapResult(vm.callFunction(n, vm.undefined, handle)))\n      )\n  )\n    return;\n\n  const raw = call(vm, \"Array.isArray\", undefined, handle).consume((r) =>\n    vm.dump(r)\n  )\n    ? []\n    : {};\n  const obj = preUnmarshal(raw, handle) ?? raw;\n\n  const prototype = call(\n    vm,\n    `o => {\n      const p = Object.getPrototypeOf(o);\n      return !p || p === Object.prototype || p === Array.prototype ? undefined : p;\n    }`,\n    undefined,\n    handle\n  ).consume((prototype) => {\n    if (vm.typeof(prototype) === \"undefined\") return;\n    const [proto] = unmarshal(prototype);\n    return proto;\n  });\n  if (typeof prototype === \"object\") {\n    Object.setPrototypeOf(obj, prototype);\n  }\n\n  unmarshalProperties(vm, handle, raw, unmarshal);\n\n  return obj;\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\n\nexport default function unmarshalPrimitive(\n  vm: QuickJSVm,\n  handle: QuickJSHandle\n): [any, boolean] {\n  const ty = vm.typeof(handle);\n  if (\n    ty === \"undefined\" ||\n    ty === \"number\" ||\n    ty === \"string\" ||\n    ty === \"boolean\"\n  ) {\n    return [vm.dump(handle), true];\n  } else if (ty === \"object\") {\n    const isNull = vm\n      .unwrapResult(vm.evalCode(\"a => a === null\"))\n      .consume((n) =>\n        vm.dump(vm.unwrapResult(vm.callFunction(n, vm.undefined, handle)))\n      );\n    if (isNull) {\n      return [null, true];\n    }\n  }\n\n  // BigInt is not supported by quickjs-emscripten\n  // if (ty === \"bigint\") {\n  //   const str = vm\n  //     .getProp(handle, \"toString\")\n  //     .consume(toString => vm.unwrapResult(vm.callFunction(toString, handle)))\n  //     .consume(str => vm.getString(str));\n  //   const bi = BigInt(str);\n  //   return [bi, true];\n  // }\n\n  return [undefined, false];\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\n\nexport default function unmarshalSymbol(\n  vm: QuickJSVm,\n  handle: QuickJSHandle,\n  preUnmarshal: <T>(target: T, handle: QuickJSHandle) => T | undefined\n): symbol | undefined {\n  if (vm.typeof(handle) !== \"symbol\") return;\n  const desc = vm.getString(vm.getProp(handle, \"description\"));\n  const sym = Symbol(desc);\n  return preUnmarshal(sym, handle) ?? sym;\n}\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport unmarshalFunction from \"./function\";\nimport unmarshalObject from \"./object\";\nimport unmarshalPrimitive from \"./primitive\";\nimport unmarshalSymbol from \"./symbol\";\n\nexport type Options = {\n  vm: QuickJSVm;\n  marshal: (target: unknown) => QuickJSHandle;\n  find: (handle: QuickJSHandle) => unknown | undefined;\n  pre: <T>(target: T, handle: QuickJSHandle) => T | undefined;\n};\n\nexport function unmarshal(handle: QuickJSHandle, options: Options): any {\n  const [result] = unmarshalInner(handle, options);\n  return result;\n}\n\nfunction unmarshalInner(\n  handle: QuickJSHandle,\n  options: Options\n): [any, boolean] {\n  const { vm, marshal, find, pre } = options;\n\n  {\n    const [target, ok] = unmarshalPrimitive(vm, handle);\n    if (ok) return [target, false];\n  }\n\n  {\n    const target = find(handle);\n    if (target) {\n      return [target, true];\n    }\n  }\n\n  const unmarshal2 = (h: QuickJSHandle) => unmarshalInner(h, options);\n\n  const result =\n    unmarshalSymbol(vm, handle, pre) ??\n    unmarshalFunction(vm, handle, marshal, unmarshal2, pre) ??\n    unmarshalObject(vm, handle, unmarshal2, pre);\n\n  return [result, false];\n}\n\nexport default unmarshal;\n","import { QuickJSVm, QuickJSHandle } from \"quickjs-emscripten\";\nimport { isObject } from \"./util\";\nimport { call, isHandleObject, consumeAll } from \"./vmutil\";\n\nexport type SyncMode = \"both\" | \"vm\" | \"host\";\n\nexport type Wrapped<T> = T & { __qes_wrapped: never };\n\nexport function wrap<T = any>(\n  vm: QuickJSVm,\n  target: T,\n  proxyKeySymbol: symbol,\n  proxyKeySymbolHandle: QuickJSHandle,\n  marshal: (target: any) => QuickJSHandle,\n  syncMode?: (target: T) => SyncMode | undefined\n): Wrapped<T> | undefined {\n  if (!isObject(target)) return undefined;\n  if (isWrapped(target, proxyKeySymbol)) return target;\n\n  const rec = new Proxy(target as any, {\n    get(obj, key) {\n      return key === proxyKeySymbol ? obj : Reflect.get(obj, key);\n    },\n    set(obj, key, value, receiver) {\n      const v = unwrap(value, proxyKeySymbol);\n      const sync = syncMode?.(receiver) ?? \"host\";\n      if (sync === \"vm\" || Reflect.set(obj, key, v, receiver)) {\n        if (sync === \"host\") return true;\n        const [handle2, unwrapped] = unwrapHandle(\n          vm,\n          marshal(receiver),\n          proxyKeySymbolHandle\n        );\n        if (unwrapped) {\n          handle2.consume((h) => vm.setProp(h, marshal(key), marshal(v)));\n        } else {\n          vm.setProp(handle2, marshal(key), marshal(v));\n        }\n      }\n      return true;\n    },\n    deleteProperty(obj, key) {\n      const sync = syncMode?.(rec) ?? \"host\";\n      const [handle2, unwrapped] = unwrapHandle(\n        vm,\n        marshal(rec),\n        proxyKeySymbolHandle\n      );\n      if (sync === \"vm\" || Reflect.deleteProperty(obj, key)) {\n        if (sync === \"host\") return true;\n        if (unwrapped) {\n          handle2.consume((h) =>\n            call(vm, `(a, b) => delete a[b]`, undefined, h, marshal(key))\n          );\n        } else {\n          call(vm, `(a, b) => delete a[b]`, undefined, handle2, marshal(key));\n        }\n      }\n      return true;\n    },\n  }) as Wrapped<T>;\n  return rec;\n}\n\nexport function wrapHandle(\n  vm: QuickJSVm,\n  handle: QuickJSHandle,\n  proxyKeySymbol: symbol,\n  proxyKeySymbolHandle: QuickJSHandle,\n  unmarshal: (handle: QuickJSHandle) => any,\n  syncMode?: (target: QuickJSHandle) => SyncMode | undefined\n): [Wrapped<QuickJSHandle> | undefined, boolean] {\n  if (!isHandleObject(vm, handle)) return [undefined, false];\n  if (isHandleWrapped(vm, handle, proxyKeySymbolHandle)) return [handle, false];\n\n  return consumeAll(\n    [\n      vm.newFunction(\"getSyncMode\", (h) => {\n        const res = syncMode?.(unmarshal(h));\n        if (typeof res === \"string\") return vm.newString(res);\n        return vm.undefined;\n      }),\n      vm.newFunction(\"setter\", (h, keyHandle, valueHandle) => {\n        const target = unmarshal(h);\n        if (!target) return;\n        const key = unmarshal(keyHandle);\n        if (key === \"__proto__\") return; // for security\n        const value = unmarshal(valueHandle);\n        unwrap(target, proxyKeySymbol)[key] = value;\n      }),\n      vm.newFunction(\"deleter\", (h, keyHandle) => {\n        const target = unmarshal(h);\n        if (!target) return;\n        const key = unmarshal(keyHandle);\n        delete unwrap(target, proxyKeySymbol)[key];\n      }),\n    ],\n    (args) => [\n      call(\n        vm,\n        `(target, sym, getSyncMode, setter, deleter) => {\n          const rec =  new Proxy(target, {\n            get(obj, key, receiver) {\n              return key === sym ? obj : Reflect.get(obj, key, receiver)\n            },\n            set(obj, key, value, receiver) {\n              const v = typeof value === \"object\" && value !== null || typeof value === \"function\"\n                ? value[sym] ?? value\n                : value;\n              const sync = getSyncMode(receiver) ?? \"vm\";\n              if (sync === \"host\" || Reflect.set(obj, key, v, receiver)) {\n                if (sync !== \"vm\") {\n                  setter(receiver, key, v);\n                }\n              }\n              return true;\n            },\n            deleteProperty(obj, key) {\n              const sync = getSyncMode(rec) ?? \"vm\";\n              if (sync === \"host\" || Reflect.deleteProperty(obj, key)) {\n                if (sync !== \"vm\") {\n                  deleter(rec, key);\n                }\n              }\n              return true;\n            },\n          });\n          return rec;\n        }`,\n        undefined,\n        handle,\n        proxyKeySymbolHandle,\n        ...args\n      ) as Wrapped<QuickJSHandle>,\n      true,\n    ]\n  );\n}\n\nexport function unwrap<T>(obj: T, key: string | symbol): T {\n  return isObject(obj) ? ((obj as any)[key] as T) ?? obj : obj;\n}\n\nexport function unwrapHandle(\n  vm: QuickJSVm,\n  handle: QuickJSHandle,\n  key: QuickJSHandle\n): [QuickJSHandle, boolean] {\n  if (!isHandleWrapped(vm, handle, key)) return [handle, false];\n  return [vm.getProp(handle, key), true];\n}\n\nexport function isWrapped<T>(obj: T, key: string | symbol): obj is Wrapped<T> {\n  return isObject(obj) && !!(obj as any)[key];\n}\n\nexport function isHandleWrapped(\n  vm: QuickJSVm,\n  handle: QuickJSHandle,\n  key: QuickJSHandle\n): handle is Wrapped<QuickJSHandle> {\n  return !!vm.dump(\n    call(\n      vm,\n      `(a, s) => (typeof a === \"object\" && a !== null || typeof a === \"function\") && !!a[s]`,\n      undefined,\n      handle,\n      key\n    )\n  );\n}\n","/**\n * Default value of registeredObjects option of the Arena class constructor.\n */\nexport const defaultRegisteredObjects: [any, string][] = [\n  // basic objects\n  [Symbol, \"Symbol\"],\n  [Symbol.prototype, \"Symbol.prototype\"],\n  [Object, \"Object\"],\n  [Object.prototype, \"Object.prototype\"],\n  [Function, \"Function\"],\n  [Function.prototype, \"Function.prototype\"],\n  [Boolean, \"Boolean\"],\n  [Boolean.prototype, \"Boolean.prototype\"],\n  [Array, \"Array\"],\n  [Array.prototype, \"Array.prototype\"],\n  // [BigInt, \"BigInt\"],\n  // [BigInt.prototype, \"BigInt.prototype\"],\n  // errors\n  [Error, \"Error\"],\n  [Error.prototype, \"Error.prototype\"],\n  [EvalError, \"EvalError\"],\n  [EvalError.prototype, \"EvalError.prototype\"],\n  [RangeError, \"RangeError\"],\n  [RangeError.prototype, \"RangeError.prototype\"],\n  [ReferenceError, \"ReferenceError\"],\n  [ReferenceError.prototype, \"ReferenceError.prototype\"],\n  [SyntaxError, \"SyntaxError\"],\n  [SyntaxError.prototype, \"SyntaxError.prototype\"],\n  [TypeError, \"TypeError\"],\n  [TypeError.prototype, \"TypeError.prototype\"],\n  [URIError, \"URIError\"],\n  [URIError.prototype, \"URIError.prototype\"],\n  // built-in symbols\n  ...Object.getOwnPropertyNames(Symbol)\n    .filter((k) => typeof (Symbol as any)[k] === \"symbol\")\n    .map<[any, string]>((k) => [(Symbol as any)[k], `Symbol.${k}`]),\n];\n","import { QuickJSHandle, QuickJSVm } from \"quickjs-emscripten\";\nimport {\n  SuccessOrFail,\n  VmCallResult,\n} from \"quickjs-emscripten/dist/vm-interface\";\n\nimport VMMap from \"./vmmap\";\nimport marshal from \"./marshal\";\nimport unmarshal from \"./unmarshal\";\nimport { wrap, wrapHandle, unwrap, unwrapHandle, Wrapped } from \"./wrapper\";\nimport { complexity, isES2015Class, isObject, walkObject } from \"./util\";\nimport { call, eq, isHandleObject, send, consumeAll } from \"./vmutil\";\nimport { defaultRegisteredObjects } from \"./default\";\n\nexport {\n  VMMap,\n  defaultRegisteredObjects,\n  marshal,\n  unmarshal,\n  complexity,\n  isES2015Class,\n  isObject,\n  walkObject,\n  call,\n  eq,\n  isHandleObject,\n  send,\n  consumeAll,\n};\n\nexport type Options = {\n  /** A callback that returns a boolean value that determines whether an object is marshalled or not. If false, no marshaling will be done and undefined will be passed to the QuickJS VM, otherwise marshaling will be done. By default, all objects will be marshalled. */\n  isMarshalable?: (target: any) => boolean;\n  /** You can pre-register a pair of objects that will be considered the same between the host and the QuickJS VM. This will be used automatically during the conversion. By default, it will be registered automatically with `defaultRegisteredObjects`.\n   *\n   * Instead of a string, you can also pass a QuickJSHandle directly. In that case, however, you have to dispose of them manually when destroying the VM.\n   */\n  registeredObjects?: Iterable<[any, QuickJSHandle | string]>;\n};\n\n/**\n * The Arena class manages all generated handles at once by quickjs-emscripten and automatically converts objects between the host and the QuickJS VM.\n */\nexport class Arena {\n  vm: QuickJSVm;\n  _map: VMMap;\n  _registeredMap: VMMap;\n  _registeredMapDispose: Set<any> = new Set();\n  _sync: Set<any> = new Set();\n  _temporalSync: Set<any> = new Set();\n  _symbol = Symbol();\n  _symbolHandle: QuickJSHandle;\n  _options?: Options;\n\n  /** Constructs a new Arena instance. It requires a quickjs-emscripten VM initialized with `quickjs.createVM()`. */\n  constructor(vm: QuickJSVm, options?: Options) {\n    this.vm = vm;\n    this._options = options;\n    this._symbolHandle = vm.unwrapResult(vm.evalCode(`Symbol()`));\n    this._map = new VMMap(vm);\n    this._registeredMap = new VMMap(vm);\n    this.registerAll(options?.registeredObjects ?? defaultRegisteredObjects);\n  }\n\n  /**\n   * Dispose of the arena and managed handles. This method won't dispose the VM itself, so the VM has to be disposed of manually.\n   */\n  dispose() {\n    this._map.dispose();\n    this._registeredMap.dispose();\n    this._symbolHandle.dispose();\n  }\n\n  /**\n   * Evaluate JS code in the VM and get the result as an object on the host side. It also converts and re-throws error objects when an error is thrown during evaluation.\n   */\n  evalCode<T = any>(code: string): T {\n    const handle = this.vm.evalCode(code);\n    return this._unwrapResultAndUnmarshal(handle);\n  }\n\n  /**\n   * Almost same as `vm.executePendingJobs()`, but it converts and re-throws error objects when an error is thrown during evaluation.\n   */\n  executePendingJobs(maxJobsToExecute?: number): number {\n    const result = this.vm.executePendingJobs(maxJobsToExecute);\n    if (\"value\" in result) {\n      return result.value;\n    }\n    throw result.error.consume((err) => this._unmarshal(err));\n  }\n\n  /**\n   * Expose objects as global objects in the VM.\n   *\n   * By default, exposed objects are not synchronized between the host and the VM.\n   * If you want to sync an objects, first wrap the object with sync method, and then expose the wrapped object.\n   */\n  expose(obj: { [k: string]: any }) {\n    for (const [key, value] of Object.entries(obj)) {\n      const handle = this._marshal(value);\n      this.vm.setProp(this.vm.global, key, handle);\n    }\n  }\n\n  /**\n   * Enables sync for the object between the host and the VM and returns objects wrapped with proxies.\n   *\n   * The return value is necessary in order to reflect changes to the object from the host to the VM. Please note that setting a value in the field or deleting a field in the original object will not synchronize it.\n   */\n  sync<T>(target: T): T {\n    const wrapped = this._wrap(target);\n    if (typeof wrapped === \"undefined\") return target;\n    walkObject(wrapped, (v) => {\n      this._sync.add(this._unwrap(v));\n    });\n    return wrapped;\n  }\n\n  /**\n   * Register a pair of objects that will be considered the same between the host and the QuickJS VM.\n   *\n   * Instead of a string, you can also pass a QuickJSHandle directly. In that case, however, when  you have to dispose them manually when destroying the VM.\n   */\n  register(target: any, handleOrCode: QuickJSHandle | string) {\n    if (this._registeredMap.has(target)) return;\n    const handle =\n      typeof handleOrCode === \"string\"\n        ? this._unwrapResult(this.vm.evalCode(handleOrCode))\n        : handleOrCode;\n    if (eq(this.vm, handle, this.vm.undefined)) return;\n    if (typeof handleOrCode === \"string\") {\n      this._registeredMapDispose.add(target);\n    }\n    this._registeredMap.set(target, handle);\n  }\n\n  /**\n   * Execute `register` methods for each pair.\n   */\n  registerAll(map: Iterable<[any, QuickJSHandle | string]>) {\n    for (const [k, v] of map) {\n      this.register(k, v);\n    }\n  }\n\n  /**\n   * Unregister a pair of objects that were registered with `registeredObjects` option and `register` method.\n   */\n  unregister(target: any, dispose?: boolean) {\n    this._registeredMap.delete(\n      target,\n      this._registeredMapDispose.has(target) || dispose\n    );\n    this._registeredMapDispose.delete(target);\n  }\n\n  /**\n   * Execute `unregister` methods for each target.\n   */\n  unregisterAll(targets: Iterable<any>, dispose?: boolean) {\n    for (const t of targets) {\n      this.unregister(t, dispose);\n    }\n  }\n\n  startSync(target: any) {\n    if (!isObject(target)) return;\n    this._sync.add(this._unwrap(target));\n  }\n\n  endSync(target: any) {\n    this._sync.delete(this._unwrap(target));\n  }\n\n  _unwrapResult<T>(result: SuccessOrFail<T, QuickJSHandle>): T {\n    if (\"value\" in result) {\n      return result.value;\n    }\n    throw result.error.consume((err) => this._unmarshal(err));\n  }\n\n  _unwrapResultAndUnmarshal(\n    result: VmCallResult<QuickJSHandle> | undefined\n  ): any {\n    if (!result) return;\n    return this._unwrapResult(result).consume((h) => this._unmarshal(h));\n  }\n\n  _marshal(target: any): QuickJSHandle {\n    const registered = this._registeredMap.get(target);\n    if (registered) {\n      return registered;\n    }\n\n    const handle = marshal(this._wrap(target) ?? target, {\n      vm: this.vm,\n      unmarshal: (h) => this._unmarshal(h),\n      isMarshalable: (t) =>\n        this._options?.isMarshalable?.(this._unwrap(t)) ?? true,\n      find: (t) => this._registeredMap.get(t) ?? this._map.get(t),\n      pre: (t, h) => this._register(t, h, this._map)?.[1],\n      preApply: (target, that, args) => {\n        const unwrapped = isObject(that) ? this._unwrap(that) : undefined;\n        // override sync mode of this object while calling the function\n        if (unwrapped) this._temporalSync.add(unwrapped);\n        try {\n          return target.apply(that, args);\n        } finally {\n          // restore sync mode\n          if (unwrapped) this._temporalSync.delete(unwrapped);\n        }\n      },\n    });\n\n    return handle;\n  }\n\n  _unmarshal(handle: QuickJSHandle): any {\n    const registered = this._registeredMap.getByHandle(handle);\n    if (typeof registered !== \"undefined\") {\n      return registered;\n    }\n\n    const [wrappedHandle] = this._wrapHandle(handle);\n    return unmarshal(wrappedHandle ?? handle, {\n      vm: this.vm,\n      marshal: (v: any) => this._marshal(v),\n      find: (h) =>\n        this._registeredMap.getByHandle(h) ?? this._map.getByHandle(h),\n      pre: (t: any, h: QuickJSHandle) =>\n        this._register(t, h, undefined, true)?.[0],\n    });\n  }\n\n  _register(\n    t: any,\n    h: QuickJSHandle,\n    map: VMMap = this._map,\n    sync?: boolean\n  ): [Wrapped<any>, Wrapped<QuickJSHandle>] | undefined {\n    if (this._registeredMap.has(t) || this._registeredMap.hasHandle(h)) {\n      return;\n    }\n\n    const wrappedT = this._wrap(t);\n    const [wrappedH] = this._wrapHandle(h);\n    if (!wrappedT || !wrappedH) return; // t or h is not an object\n\n    const unwrappedT = this._unwrap(t);\n    const [unwrappedH, unwrapped] = this._unwrapHandle(h);\n\n    const res = map.set(wrappedT, wrappedH, unwrappedT, unwrappedH);\n    if (!res) {\n      // already registered\n      if (unwrapped) unwrappedH.dispose();\n      throw new Error(\"already registered\");\n    } else if (sync) {\n      this._sync.add(unwrappedT);\n    }\n\n    return [wrappedT, wrappedH];\n  }\n\n  _syncMode(obj: any) {\n    const obj2 = this._unwrap(obj);\n    return this._sync.has(obj2) || this._temporalSync.has(obj2)\n      ? \"both\"\n      : undefined;\n  }\n\n  _wrap<T>(target: T): Wrapped<T> | undefined {\n    return wrap(\n      this.vm,\n      target,\n      this._symbol,\n      this._symbolHandle,\n      (t) => this._marshal(t),\n      (t) => this._syncMode(t)\n    );\n  }\n\n  _unwrap<T>(target: T): T {\n    return unwrap(target, this._symbol);\n  }\n\n  _wrapHandle(\n    handle: QuickJSHandle\n  ): [Wrapped<QuickJSHandle> | undefined, boolean] {\n    return wrapHandle(\n      this.vm,\n      handle,\n      this._symbol,\n      this._symbolHandle,\n      (h) => this._unmarshal(h),\n      (t) => this._syncMode(t)\n    );\n  }\n\n  _unwrapHandle(target: QuickJSHandle): [QuickJSHandle, boolean] {\n    return unwrapHandle(this.vm, target, this._symbolHandle);\n  }\n}\n"],"names":["Symbol","iterator","VMMap","constructor","vm","_map1","Map","_map2","_map3","_map4","_counterMap","_disposables","Set","_mapGet","_mapSet","_mapDelete","_mapClear","_counter","result","unwrapResult","evalCode","consume","fn","_call","undefined","getProp","dispose","add","set","key","handle","key2","handle2","alive","v","get","counter","newNumber","c","merge","iteratable","iter","num","delete","getByHandle","getNumber","has","hasHandle","filter","h","k","deleteByHandle","clear","values","size","keys","next","k1","done","value","n","v1","v2","k2","_get2","thisArg","args","callFunction","isES2015Class","cls","test","Function","prototype","toString","call","isObject","walkObject","callback","walk","Array","isArray","e","proto","Object","getPrototypeOf","d","getOwnPropertyDescriptors","complexity","max","_","code","f","length","eq","a","b","dump","isHandleObject","send","target","json","JSON","stringify","newString","consumeAll","handles","cb","marshalProperties","marshal","descs","newObject","desc","keyHandle","valueHandle","getHandle","setHandle","descObj","entries","forEach","true","false","setProp","getOwnPropertySymbols","marshalFunction","unmarshal","preMarshal","preApply","raw","newFunction","name","argHandles","that","map","apply","marshalObject","newArray","prototypeHandle","marshalPrimitive","null","marshalSymbol","description","options","isMarshalable","find","pre","primitive","marshal2","t","unmarshalProperties","keyName","reduce","unmarshable","ty","typeof","alreadyExists","defineProperty","unmarshalFunction","preUnmarshal","thisHandle","new","instance","defineProperties","resultHandle","func","unmarshalObject","r","obj","setPrototypeOf","unmarshalPrimitive","isNull","unmarshalSymbol","getString","sym","unmarshalInner","ok","unmarshal2","wrap","proxyKeySymbol","proxyKeySymbolHandle","syncMode","isWrapped","rec","Proxy","Reflect","receiver","unwrap","sync","unwrapped","unwrapHandle","deleteProperty","wrapHandle","isHandleWrapped","res","defaultRegisteredObjects","Boolean","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError","getOwnPropertyNames","Arena","_map","_registeredMap","_registeredMapDispose","_sync","_temporalSync","_symbol","_symbolHandle","_options","registerAll","registeredObjects","_unwrapResultAndUnmarshal","executePendingJobs","maxJobsToExecute","error","err","_unmarshal","expose","_marshal","global","wrapped","_wrap","_unwrap","register","handleOrCode","_unwrapResult","unregister","unregisterAll","targets","startSync","endSync","registered","_register","wrappedHandle","_wrapHandle","wrappedT","wrappedH","unwrappedT","unwrappedH","_unwrapHandle","_syncMode","obj2"],"mappings":"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"}